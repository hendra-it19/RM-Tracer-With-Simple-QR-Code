import{r as o,j as e}from"./index-CSak_wTG.js";import{L as k}from"./index-BeZcMjBn.js";import{s as S}from"./createLucideIcon-6Q1StMY_.js";import{u as b}from"./AuthContext-Bg7guHVU.js";import{S as c}from"./constants-Czdmcpm8.js";import{a as y,b as f,g as _,i as N}from"./helpers-BFGMH2X3.js";import{C as w}from"./clock-BtxGCLuv.js";import{M as A}from"./map-pin-BmBLyqC7.js";import{F as T}from"./file-text--9lyR9Wh.js";import{C as D}from"./chevron-right-FAfa_QAd.js";import"./index-jxamHYc2.js";const B=()=>{const{profile:n}=b(),[m,u]=o.useState([]),[p,x]=o.useState(!0),[i,g]=o.useState("today");o.useEffect(()=>{n?.id&&v()},[n,i]);const v=async()=>{x(!0);try{let s=S.from("activity_logs").select("*").eq("user_id",n.id).in("aksi",["UPDATE_STATUS","SCAN_QR"]).order("created_at",{ascending:!1}).limit(50);const a=new Date;if(i==="today"){const t=new Date;t.setHours(0,0,0,0),s=s.gte("created_at",t.toISOString())}else if(i==="week"){const t=new Date;t.setDate(t.getDate()-7),s=s.gte("created_at",t.toISOString())}else if(i==="month"){const t=new Date;t.setMonth(t.getMonth()-1),s=s.gte("created_at",t.toISOString())}const{data:d,error:h}=await s;if(h)throw h;const r={};d?.forEach(t=>{const l=y(t.created_at,"yyyy-MM-dd");r[l]||(r[l]=[]),r[l].push(t)}),u(Object.entries(r).map(([t,l])=>({date:t,dateLabel:y(t,"EEEE, dd MMMM yyyy"),items:l})))}catch(s){console.error("Error fetching history:",s)}x(!1)},j=[{value:"today",label:"Hari Ini"},{value:"week",label:"Minggu Ini"},{value:"month",label:"Bulan Ini"}];return e.jsxs("div",{className:"flex flex-col gap-md",children:[e.jsx("div",{className:"flex gap-sm",children:j.map(s=>e.jsx("button",{className:`btn btn-sm ${i===s.value?"btn-primary":"btn-secondary"}`,onClick:()=>g(s.value),children:s.label},s.value))}),p?e.jsx("div",{className:"flex flex-col gap-md",children:[1,2,3].map(s=>e.jsxs("div",{children:[e.jsx("div",{className:"skeleton skeleton-text mb-sm",style:{width:"50%"}}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"skeleton skeleton-text"}),e.jsx("div",{className:"skeleton skeleton-text mt-sm",style:{width:"70%"}})]})})]},s))}):m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(w,{size:48,style:{opacity:.3}}),e.jsx("p",{className:"empty-state-title mt-md",children:"Belum ada riwayat"}),e.jsx("p",{className:"empty-state-description",children:"Aktivitas scan Anda akan muncul di sini"})]}):e.jsx("div",{className:"flex flex-col gap-lg",children:m.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-secondary mb-sm",style:{paddingLeft:4},children:s.dateLabel}),e.jsx("div",{className:"card",children:e.jsx("div",{style:{padding:0},children:s.items.map((a,d)=>e.jsxs(k,{to:"/petugas/scan",state:{noRm:a.no_rm},className:"flex items-center gap-md",style:{padding:"var(--spacing-md)",borderBottom:d<s.items.length-1?"1px solid var(--border)":"none",textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"var(--radius-lg)",background:a.details?.status_lokasi?`${f(a.details.status_lokasi,c)}20`:"var(--gray-100)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:a.aksi==="UPDATE_STATUS"?e.jsx(A,{size:18,style:{color:a.details?.status_lokasi?f(a.details.status_lokasi,c):"var(--gray-500)"}}):e.jsx(T,{size:18,style:{color:"var(--gray-500)"}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{className:"font-medium",children:a.no_rm}),e.jsx("div",{className:"text-sm text-secondary",children:a.aksi==="UPDATE_STATUS"&&a.details?.status_lokasi?_(a.details.status_lokasi,c):"Scan QR"})]}),e.jsx("div",{className:"text-sm text-muted",style:{flexShrink:0},children:N(a.created_at).split(", ")[1]}),e.jsx(D,{size:16,style:{color:"var(--text-muted)",flexShrink:0}})]},a.id))})})]},s.date))})]})};export{B as default};
