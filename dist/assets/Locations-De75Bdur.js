import{r as n,a as R,s as d,I as j,j as a,X as G}from"./index-BDgF81px.js";import{P as A,a as D,T as q,C as $,b as F}from"./trash-2-BkqsbA9l.js";import{S as H}from"./search-ddN_mJET.js";import{M as I}from"./map-pin-CgCR9dCj.js";const O=()=>{const[g,v]=n.useState([]),[C,b]=n.useState(!0),[o,S]=n.useState(""),[i,m]=n.useState(1),[L,P]=n.useState(0),[w,l]=n.useState(!1),[h,f]=n.useState(null),[t,r]=n.useState({name:"",type:"poli",description:"",is_storage:!1}),[k,N]=n.useState(!1),{success:x,error:c}=R();n.useEffect(()=>{p()},[i,o]);const p=async()=>{b(!0);try{let e=d.from("locations").select("*",{count:"exact"}).order("name",{ascending:!0}).range((i-1)*j,i*j-1);o&&(e=e.ilike("name",`%${o}%`));const{data:s,count:z,error:y}=await e;if(y)throw y;v(s||[]),P(z||0)}catch(e){c("Gagal memuat data lokasi"),console.error(e)}b(!1)},M=()=>{f(null),r({name:"",type:"poli",description:"",is_storage:!1}),l(!0)},E=e=>{f(e),r({name:e.name,type:e.type||"poli",description:e.description||"",is_storage:e.is_storage||!1}),l(!0)},T=async e=>{if(e.preventDefault(),!t.name){c("Nama lokasi harus diisi");return}N(!0);try{if(h){const{error:s}=await d.from("locations").update(t).eq("id",h.id);if(s)throw s;x("Lokasi berhasil diperbarui")}else{const{error:s}=await d.from("locations").insert(t);if(s)throw s;x("Lokasi baru berhasil ditambahkan")}l(!1),p()}catch(s){c(s.message||"Gagal menyimpan lokasi"),console.error(s)}N(!1)},_=async e=>{if(confirm(`Hapus lokasi ${e.name}?

Pastikan lokasi ini tidak sedang digunakan aktif oleh berkas.`))try{const{error:s}=await d.from("locations").delete().eq("id",e.id);if(s)throw s;x(`Lokasi ${e.name} berhasil dihapus`),p()}catch(s){c("Gagal menghapus lokasi. Mungkin sedang digunakan dalam riwayat."),console.error(s)}},u=Math.ceil(L/j);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"page-header",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"page-title",children:"Manajemen Lokasi"}),a.jsx("p",{className:"page-subtitle",children:"Kelola daftar lokasi penyimpanan berkas (Poli, Ruangan, dll)"})]}),a.jsxs("button",{className:"btn btn-primary",onClick:M,children:[a.jsx(A,{size:18}),"Tambah Lokasi"]})]})}),a.jsxs("div",{className:"page-content",children:[a.jsx("div",{className:"card mb-lg",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"search-box",children:[a.jsx(H,{className:"search-box-icon",size:18}),a.jsx("input",{type:"text",className:"form-input",placeholder:"Cari nama lokasi...",value:o,onChange:e=>{S(e.target.value),m(1)}})]})})}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nama Lokasi"}),a.jsx("th",{children:"Tipe"}),a.jsx("th",{children:"Keterangan"}),a.jsx("th",{style:{width:100},children:"Aksi"})]})}),a.jsx("tbody",{children:C?[...Array(5)].map((e,s)=>a.jsx("tr",{children:a.jsx("td",{colSpan:4,children:a.jsx("div",{className:"skeleton skeleton-text"})})},s)):g.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,children:a.jsxs("div",{className:"empty-state",children:[a.jsx(I,{className:"empty-state-icon"}),a.jsx("p",{children:"Tidak ada data lokasi"})]})})}):g.map(e=>a.jsxs("tr",{children:[a.jsx("td",{className:"font-medium",children:e.name}),a.jsx("td",{children:a.jsx("span",{className:"badge badge-gray uppercase text-xs",children:e.type})}),a.jsxs("td",{children:[e.description||"-",e.is_storage&&a.jsx("span",{className:"badge badge-primary ml-sm text-xs",children:"Penyimpanan"})]}),a.jsx("td",{children:a.jsxs("div",{className:"table-actions",children:[a.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",onClick:()=>E(e),children:a.jsx(D,{size:16})}),a.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",style:{color:"var(--error)"},onClick:()=>_(e),children:a.jsx(q,{size:16})})]})})]},e.id))})]})}),u>1&&a.jsx("div",{className:"card-footer",children:a.jsxs("div",{className:"pagination",children:[a.jsx("button",{className:"pagination-btn",disabled:i===1,onClick:()=>m(e=>e-1),children:a.jsx($,{size:16})}),a.jsxs("span",{className:"px-md text-sm text-secondary",children:["Hal ",i," dari ",u]}),a.jsx("button",{className:"pagination-btn",disabled:i===u,onClick:()=>m(e=>e+1),children:a.jsx(F,{size:16})})]})})]})]}),w&&a.jsx("div",{className:"modal-overlay",onClick:()=>l(!1),children:a.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{className:"modal-title",children:h?"Edit Lokasi":"Tambah Lokasi"}),a.jsx("button",{className:"modal-close",onClick:()=>l(!1),children:a.jsx(G,{size:20})})]}),a.jsxs("form",{onSubmit:T,children:[a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Nama Lokasi"}),a.jsx("input",{type:"text",className:"form-input",value:t.name,onChange:e=>r({...t,name:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Tipe"}),a.jsxs("select",{className:"form-input form-select",value:t.type,onChange:e=>r({...t,type:e.target.value}),children:[a.jsx("option",{value:"poli",children:"Poli"}),a.jsx("option",{value:"ruangan",children:"Ruangan"}),a.jsx("option",{value:"gudang",children:"Gudang / Arsip"}),a.jsx("option",{value:"lainnya",children:"Lainnya"})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Deskripsi"}),a.jsx("textarea",{className:"form-input",value:t.description,onChange:e=>r({...t,description:e.target.value})})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:t.is_storage,onChange:e=>r({...t,is_storage:e.target.checked})}),a.jsx("span",{children:"Ruangan Penyimpanan (Gudang/Rak)"})]}),a.jsx("p",{className:"text-xs text-secondary mt-xs ml-lg",children:"Jika dicentang, pengembalian berkas ke lokasi ini tidak memerlukan input petugas pengambil."})]})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>l(!1),children:"Batal"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:k,children:k?"Menyimpan...":"Simpan"})]})]})]})})]})};export{O as default};
