import{r as t,a as I,s as d,I as j,j as a,X as U}from"./index-BDgF81px.js";import{P as q,a as G,T as $,C as L,b as R}from"./trash-2-BkqsbA9l.js";import{S as B}from"./search-ddN_mJET.js";import{U as F}from"./users-Bh6ioIii.js";import{U as H}from"./user-check-BQTLTD8b.js";import{U as X}from"./user-x-B8rYHboh.js";const Y=()=>{const[b,y]=t.useState([]),[S,g]=t.useState(!0),[l,C]=t.useState(""),[i,u]=t.useState(1),[P,w]=t.useState(0),[_,r]=t.useState(!1),[x,N]=t.useState(null),[n,c]=t.useState({nama:"",nip:"",is_active:!0}),[f,v]=t.useState(!1),{success:m,error:o}=I();t.useEffect(()=>{h()},[i,l]);const h=async()=>{g(!0);try{let e=d.from("staff").select("*",{count:"exact"}).order("nama",{ascending:!0}).range((i-1)*j,i*j-1);l&&(e=e.or(`nama.ilike.%${l}%,nip.ilike.%${l}%`));const{data:s,count:A,error:k}=await e;if(k)throw k;y(s||[]),w(A||0)}catch(e){o("Gagal memuat data petugas"),console.error(e)}g(!1)},E=()=>{N(null),c({nama:"",nip:"",is_active:!0}),r(!0)},z=e=>{N(e),c({nama:e.nama,nip:e.nip||"",is_active:e.is_active}),r(!0)},M=async e=>{if(e.preventDefault(),!n.nama){o("Nama petugas harus diisi");return}v(!0);try{if(x){const{error:s}=await d.from("staff").update(n).eq("id",x.id);if(s)throw s;m("Data petugas berhasil diperbarui")}else{const{error:s}=await d.from("staff").insert(n);if(s)throw s;m("Petugas baru berhasil ditambahkan")}r(!1),h()}catch(s){o(s.message||"Gagal menyimpan data petugas"),console.error(s)}v(!1)},D=async e=>{if(confirm(`Hapus petugas ${e.nama}?

Disarankan untuk menonaktifkan saja jika sudah pernah melakukan transaksi.`))try{const{error:s}=await d.from("staff").delete().eq("id",e.id);if(s)throw s;m(`Petugas ${e.nama} berhasil dihapus`),h()}catch(s){o("Gagal menghapus petugas. Mungkin sedang digunakan dalam riwayat."),console.error(s)}},T=async e=>{try{const{error:s}=await d.from("staff").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;h(),m("Status petugas diperbarui")}catch(s){console.error(s),o("Gagal mengubah status")}},p=Math.ceil(P/j);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"page-header",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"page-title",children:"Manajemen Petugas Pengambil Berkas"}),a.jsx("p",{className:"page-subtitle",children:"Daftar petugas yang berwenang mengambil berkas rekam medis"})]}),a.jsxs("button",{className:"btn btn-primary",onClick:E,children:[a.jsx(q,{size:18}),"Tambah Petugas"]})]})}),a.jsxs("div",{className:"page-content",children:[a.jsx("div",{className:"card mb-lg",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"search-box",children:[a.jsx(B,{className:"search-box-icon",size:18}),a.jsx("input",{type:"text",className:"form-input",placeholder:"Cari nama atau NIP...",value:l,onChange:e=>{C(e.target.value),u(1)}})]})})}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nama Petugas"}),a.jsx("th",{children:"NIP / ID"}),a.jsx("th",{children:"Status"}),a.jsx("th",{style:{width:150},children:"Aksi"})]})}),a.jsx("tbody",{children:S?[...Array(5)].map((e,s)=>a.jsx("tr",{children:a.jsx("td",{colSpan:4,children:a.jsx("div",{className:"skeleton skeleton-text"})})},s)):b.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,children:a.jsxs("div",{className:"empty-state",children:[a.jsx(F,{className:"empty-state-icon"}),a.jsx("p",{children:"Tidak ada data petugas"})]})})}):b.map(e=>a.jsxs("tr",{children:[a.jsx("td",{className:"font-medium",children:e.nama}),a.jsx("td",{children:e.nip||"-"}),a.jsx("td",{children:a.jsx("span",{className:`badge ${e.is_active?"badge-success":"badge-gray"}`,children:e.is_active?"Aktif":"Nonaktif"})}),a.jsx("td",{children:a.jsxs("div",{className:"table-actions",children:[a.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",onClick:()=>T(e),title:e.is_active?"Nonaktifkan":"Aktifkan",children:e.is_active?a.jsx(H,{size:16}):a.jsx(X,{size:16})}),a.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",onClick:()=>z(e),children:a.jsx(G,{size:16})}),a.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",style:{color:"var(--error)"},onClick:()=>D(e),children:a.jsx($,{size:16})})]})})]},e.id))})]})}),p>1&&a.jsx("div",{className:"card-footer",children:a.jsxs("div",{className:"pagination",children:[a.jsx("button",{className:"pagination-btn",disabled:i===1,onClick:()=>u(e=>e-1),children:a.jsx(L,{size:16})}),a.jsxs("span",{className:"px-md text-sm text-secondary",children:["Hal ",i," dari ",p]}),a.jsx("button",{className:"pagination-btn",disabled:i===p,onClick:()=>u(e=>e+1),children:a.jsx(R,{size:16})})]})})]})]}),_&&a.jsx("div",{className:"modal-overlay",onClick:()=>r(!1),children:a.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{className:"modal-title",children:x?"Edit Petugas":"Tambah Petugas"}),a.jsx("button",{className:"modal-close",onClick:()=>r(!1),children:a.jsx(U,{size:20})})]}),a.jsxs("form",{onSubmit:M,children:[a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Nama Petugas"}),a.jsx("input",{type:"text",className:"form-input",value:n.nama,onChange:e=>c({...n,nama:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"NIP (Opsional)"}),a.jsx("input",{type:"text",className:"form-input",value:n.nip,onChange:e=>c({...n,nip:e.target.value})})]}),a.jsx("div",{className:"form-group",children:a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:n.is_active,onChange:e=>c({...n,is_active:e.target.checked})}),a.jsx("span",{children:"Aktif"})]})})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>r(!1),children:"Batal"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:f,children:f?"Menyimpan...":"Simpan"})]})]})]})})]})};export{Y as default};
