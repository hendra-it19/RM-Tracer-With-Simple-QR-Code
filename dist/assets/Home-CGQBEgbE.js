import{u as S,r as c,s as r,j as e,d as a,S as o}from"./index-D6bRFg2V.js";import{b as f,g as k,f as _}from"./helpers-BFGMH2X3.js";import{T as b}from"./trending-up-eCag8KUF.js";import{F as m}from"./file-text-xnYVbsSq.js";import{Q as x}from"./qr-code-BHaPqPtL.js";import{C as u}from"./clock-Bd4ImM74.js";const R=()=>{const{profile:t}=S(),[n,h]=c.useState({todayScans:0,weekScans:0}),[d,g]=c.useState([]),[j,l]=c.useState(!0);c.useEffect(()=>{v()},[t]);const v=async()=>{if(t?.id){l(!0);try{const s=new Date;s.setHours(0,0,0,0);const i=new Date;i.setDate(i.getDate()-7),i.setHours(0,0,0,0);const{count:p}=await r.from("activity_logs").select("*",{count:"exact",head:!0}).eq("user_id",t.id).eq("aksi","UPDATE_STATUS").gte("created_at",s.toISOString()),{count:N}=await r.from("activity_logs").select("*",{count:"exact",head:!0}).eq("user_id",t.id).eq("aksi","UPDATE_STATUS").gte("created_at",i.toISOString());h({todayScans:p||0,weekScans:N||0});const{data:y}=await r.from("activity_logs").select("*").eq("user_id",t.id).in("aksi",["UPDATE_STATUS","SCAN_QR"]).order("created_at",{ascending:!1}).limit(5);g(y||[])}catch(s){console.error("Error fetching data:",s)}l(!1)}};return e.jsxs("div",{className:"flex flex-col gap-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-md",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:n.todayScans}),e.jsx("div",{className:"stat-label",children:"Scan Hari Ini"}),e.jsx(b,{className:"stat-icon",size:40})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-value",children:n.weekScans}),e.jsx("div",{className:"stat-label",children:"Scan Minggu Ini"}),e.jsx(m,{className:"stat-icon",size:40})]})]}),e.jsxs(a,{to:"/petugas/scan",className:"btn btn-action",children:[e.jsx(x,{size:32}),e.jsx("span",{children:"Scan QR Code"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex justify-between items-center",children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600},children:"Scan Terakhir"}),e.jsxs(a,{to:"/petugas/history",className:"btn btn-ghost btn-sm",children:[e.jsx(u,{size:16}),"Lihat Semua"]})]}),e.jsx("div",{className:"card-body",style:{padding:0},children:j?e.jsx("div",{style:{padding:"var(--spacing-md)"},children:[1,2,3].map(s=>e.jsx("div",{className:"skeleton skeleton-text mb-sm"},s))}):d.length===0?e.jsxs("div",{className:"empty-state",style:{padding:"var(--spacing-xl)"},children:[e.jsx(x,{size:40,style:{opacity:.3}}),e.jsx("p",{className:"text-secondary mt-md",children:"Belum ada scan hari ini"}),e.jsx("p",{className:"text-sm text-muted",children:"Mulai scan untuk melacak berkas"})]}):e.jsx("div",{className:"recent-list",style:{padding:"var(--spacing-sm)"},children:d.map(s=>e.jsxs(a,{to:"/petugas/scan",state:{noRm:s.no_rm},className:"recent-item",children:[e.jsx("div",{className:"recent-item-dot",style:{backgroundColor:s.details?.status_lokasi?f(s.details.status_lokasi,o):"var(--gray-400)"}}),e.jsxs("div",{className:"recent-item-content",children:[e.jsx("div",{className:"recent-item-title",children:s.no_rm}),e.jsx("div",{className:"recent-item-subtitle",children:s.details?.status_lokasi?k(s.details.status_lokasi,o):s.aksi})]}),e.jsx("div",{className:"recent-item-time",children:_(s.created_at)})]},s.id))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-md",children:[e.jsx(a,{to:"/petugas/search",className:"card",style:{textDecoration:"none"},children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(m,{size:32,style:{color:"var(--primary-500)",marginBottom:8}}),e.jsx("div",{className:"font-medium",children:"Cari Manual"}),e.jsx("div",{className:"text-sm text-secondary",children:"Input No. RM"})]})}),e.jsx(a,{to:"/petugas/history",className:"card",style:{textDecoration:"none"},children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(u,{size:32,style:{color:"var(--primary-500)",marginBottom:8}}),e.jsx("div",{className:"font-medium",children:"Riwayat"}),e.jsx("div",{className:"text-sm text-secondary",children:"Lihat aktivitas"})]})})]})]})};export{R as default};
