import{r,j as s}from"./index-CSak_wTG.js";import{s as j}from"./createLucideIcon-6Q1StMY_.js";import{u as C}from"./ToastContext-ykpRnyEW.js";import{S as n}from"./constants-Czdmcpm8.js";import{a as z,c as L,g as R,b as g,h as T}from"./helpers-BFGMH2X3.js";import{u as E}from"./index-jxamHYc2.js";import{S as c}from"./search-BDv52CUj.js";import{M as f}from"./map-pin-BmBLyqC7.js";import{F as $}from"./file-text--9lyR9Wh.js";const H=()=>{const l=E(),{error:v}=C(),[o,y]=r.useState(""),[d,m]=r.useState([]),[N,h]=r.useState(!1),[k,x]=r.useState(!1),S=T(async e=>{if(!e||e.length<2){m([]),x(!1);return}h(!0),x(!0);try{const{data:a,error:u}=await j.from("patients").select("*").or(`no_rm.ilike.%${e}%,nama.ilike.%${e}%`).order("created_at",{ascending:!1}).limit(20);if(u)throw u;const _=a.map(t=>t.id),{data:w}=await j.from("tracer").select("patient_id, status_lokasi").in("patient_id",_).order("updated_at",{ascending:!1}),i={};w?.forEach(t=>{i[t.patient_id]||(i[t.patient_id]=t.status_lokasi)});const M=a.map(t=>({...t,current_status:i[t.id]||null}));m(M)}catch(a){console.error("Search error:",a),v("Gagal mencari pasien")}h(!1)},300),b=e=>{const a=e.target.value;y(a),S(a)},p=e=>{l("/petugas/scan",{state:{noRm:e.no_rm}})};return s.jsxs("div",{className:"flex flex-col gap-md",children:[s.jsxs("div",{className:"flex gap-sm",children:[s.jsxs("div",{className:"search-box flex-1",children:[s.jsx(c,{className:"search-box-icon",size:20}),s.jsx("input",{type:"text",className:"form-input",placeholder:"Cari No. RM atau nama pasien...",value:o,onChange:b,autoFocus:!0,style:{fontSize:"1rem",padding:"1rem 1rem 1rem 3rem"}})]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>l("/petugas/scan"),style:{aspectRatio:"1/1",padding:0,width:"48px"},title:"Scan QR Code",children:[s.jsx(c,{size:24,className:"hidden"})," ",s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("rect",{width:"5",height:"5",x:"3",y:"3"}),s.jsx("rect",{width:"5",height:"5",x:"16",y:"3"}),s.jsx("rect",{width:"5",height:"5",x:"3",y:"16"}),s.jsx("path",{d:"M21 16h-3a2 2 0 0 0-2 2v3"}),s.jsx("path",{d:"M21 21v.01"}),s.jsx("path",{d:"M12 7v3a2 2 0 0 1-2 2H7"}),s.jsx("path",{d:"M3 12h.01"}),s.jsx("path",{d:"M12 3h.01"}),s.jsx("path",{d:"M12 16v.01"}),s.jsx("path",{d:"M16 12h1"}),s.jsx("path",{d:"M21 12v.01"}),s.jsx("path",{d:"M12 21v-1"})]})]})]}),N?s.jsx("div",{className:"flex flex-col gap-sm",children:[1,2,3].map(e=>s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"skeleton skeleton-text",style:{width:"40%"}}),s.jsx("div",{className:"skeleton skeleton-text mt-sm"})]})},e))}):d.length>0?s.jsx("div",{className:"flex flex-col gap-sm",children:d.map(e=>s.jsx("div",{className:"card",onClick:()=>p(e),style:{cursor:"pointer"},children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("span",{className:"badge badge-primary mb-xs",style:{fontSize:"0.75rem"},children:e.no_rm}),s.jsx("h3",{style:{fontSize:"1rem",fontWeight:600},children:e.nama}),s.jsxs("div",{className:"flex items-center gap-sm text-sm text-secondary mt-xs",children:[s.jsx("span",{children:z(e.tanggal_lahir)}),s.jsx("span",{children:"â€¢"}),s.jsx("span",{children:L(e.tanggal_lahir)})]})]}),e.current_status&&s.jsxs("div",{className:"badge",style:{backgroundColor:`${g(e.current_status,n)}20`,color:g(e.current_status,n)},children:[s.jsx(f,{size:12}),R(e.current_status,n)]})]}),s.jsx("div",{className:"mt-sm pt-sm border-t border-gray-100 flex justify-end",children:s.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:a=>{a.stopPropagation(),p(e)},children:[s.jsx(f,{size:14}),"Update Lokasi"]})})]})},e.id))}):k?s.jsxs("div",{className:"empty-state",children:[s.jsx($,{size:48,style:{opacity:.3}}),s.jsx("p",{className:"empty-state-title mt-md",children:"Tidak ditemukan"}),s.jsxs("p",{className:"empty-state-description",children:['Tidak ada pasien dengan kata kunci "',o,'"']})]}):s.jsxs("div",{className:"empty-state",children:[s.jsx(c,{size:48,style:{opacity:.3}}),s.jsx("p",{className:"text-secondary mt-md",children:"Ketik minimal 2 karakter untuk mencari"})]})]})};export{H as default};
