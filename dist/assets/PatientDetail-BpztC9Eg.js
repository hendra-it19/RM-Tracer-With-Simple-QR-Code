import{r,j as e}from"./index-CSak_wTG.js";import{c as E,s as d}from"./createLucideIcon-6Q1StMY_.js";import{u as L}from"./AuthContext-Bg7guHVU.js";import{u as T}from"./ToastContext-ykpRnyEW.js";import{S as i}from"./constants-Czdmcpm8.js";import{a as U,c as z,b as x,g as N,i as D}from"./helpers-BFGMH2X3.js";import{a as M,u as H}from"./index-jxamHYc2.js";import{A as I}from"./arrow-left-DAszoeIp.js";import{C as K,a as q}from"./check-circle-pse-jaGy.js";import{U as y}from"./user-SuINNBmt.js";import{M as B}from"./map-pin-BmBLyqC7.js";import{C as G}from"./clock-BtxGCLuv.js";const R=E("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ae=()=>{const{id:c}=M(),h=H(),{profile:k}=L(),{success:w,error:p}=T(),[l,_]=r.useState(null),[n,S]=r.useState([]),[C,g]=r.useState(!0),[u,f]=r.useState(!1),[t,j]=r.useState(null),[o,b]=r.useState("");r.useEffect(()=>{P()},[c]);const P=async()=>{g(!0);try{const{data:s,error:a}=await d.from("patients").select("*").eq("id",c).single();if(a)throw a;_(s),v()}catch(s){console.error("Error fetching data:",s),p("Gagal memuat data pasien")}g(!1)},v=async()=>{const{data:s,error:a}=await d.from("tracer").select(`
                *,
                profiles:petugas_id (nama)
            `).eq("patient_id",c).order("created_at",{ascending:!1});if(a){console.error("Error fetching history:",a);return}S(s||[])},A=async()=>{if(t){f(!0);try{const{data:s,error:a}=await d.from("tracer").insert({patient_id:c,status_lokasi:t,keterangan:o||null,petugas_id:k.id}).select().single();if(a)throw a;await d.rpc("log_activity",{p_aksi:"UPDATE_STATUS_ADMIN",p_no_rm:l.no_rm,p_details:{status_lokasi:t,keterangan:o||null}}),w("Status lokasi berhasil diperbarui"),j(null),b(""),v()}catch(s){console.error("Error updating status:",s),p("Gagal memperbarui status")}f(!1)}};if(C)return e.jsxs("div",{className:"page-content",children:[e.jsx("div",{className:"skeleton",style:{height:200,marginBottom:20}}),e.jsx("div",{className:"skeleton",style:{height:400}})]});if(!l)return e.jsxs("div",{className:"page-content text-center",children:[e.jsx("h3",{children:"Pasien tidak ditemukan"}),e.jsx("button",{className:"btn btn-primary mt-md",onClick:()=>h("/admin/patients"),children:"Kembali"})]});const m=n.length>0?n[0].status_lokasi:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-sm mb-xs",children:[e.jsx("button",{className:"btn btn-icon btn-ghost btn-sm",onClick:()=>h("/admin/patients"),children:e.jsx(I,{size:20})}),e.jsx("h1",{className:"page-title",children:"Detail Pasien"})]}),e.jsx("p",{className:"page-subtitle ml-xl",children:"Informasi dan riwayat rekam medis"})]})})}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-lg",children:[e.jsxs("div",{className:"md:col-span-1 flex flex-col gap-lg",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-md",children:e.jsx("span",{className:"badge badge-primary font-mono text-lg",children:l.no_rm})}),e.jsx("h2",{className:"text-xl font-bold mb-sm",children:l.nama}),e.jsxs("div",{className:"text-secondary flex flex-col gap-xs text-sm",children:[e.jsxs("div",{className:"flex items-center gap-sm",children:[e.jsx(K,{size:16}),e.jsxs("span",{children:["Lahir: ",U(l.tanggal_lahir)]})]}),e.jsxs("div",{className:"flex items-center gap-sm",children:[e.jsx(y,{size:16}),e.jsxs("span",{children:["Usia: ",z(l.tanggal_lahir)]})]})]}),e.jsxs("div",{className:"mt-lg pt-md border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-secondary mb-xs",children:"Lokasi Terakhir"}),m?e.jsxs("div",{className:"flex items-center gap-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:x(m,i)}}),e.jsx("span",{className:"font-semibold text-lg",children:N(m,i)})]}):e.jsx("span",{className:"badge badge-gray",children:"Belum ada riwayat"})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title text-lg font-semibold flex items-center gap-sm",children:[e.jsx(B,{size:20}),"Update Lokasi"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"flex flex-col gap-sm",children:i.map(s=>e.jsxs("button",{className:`btn justify-between ${t===s.value?"active":""}`,onClick:()=>j(s.value),style:{background:t===s.value?`${s.color}10`:"white",borderColor:t===s.value?s.color:"var(--border)",borderWidth:"1px",borderStyle:"solid",color:"var(--text-primary)"},children:[e.jsxs("div",{className:"flex items-center gap-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),s.label]}),t===s.value&&e.jsx(q,{size:16,style:{color:s.color}})]},s.value))}),e.jsxs("div",{className:"mt-md",children:[e.jsx("label",{className:"form-label",children:"Keterangan"}),e.jsx("textarea",{className:"form-input",rows:2,placeholder:"Catatan tambahan...",value:o,onChange:s=>b(s.target.value)})]}),e.jsx("button",{className:"btn btn-primary btn-block mt-md",disabled:!t||u,onClick:A,children:u?"Menyimpan...":"Simpan Perubahan"})]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"card h-full",children:[e.jsxs("div",{className:"card-header flex justify-between items-center",children:[e.jsxs("h3",{className:"card-title text-lg font-semibold flex items-center gap-sm",children:[e.jsx(R,{size:20}),"Riwayat Perpindahan"]}),e.jsxs("span",{className:"text-sm text-secondary",children:["Total: ",n.length," aktivitas"]})]}),e.jsx("div",{className:"card-body",children:n.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Belum ada riwayat perpindahan berkas."})}):e.jsx("div",{className:"relative pl-4 border-l-2 border-gray-100 space-y-8",children:n.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[21px] top-1 w-3 h-3 rounded-full border-2 border-white box-content",style:{backgroundColor:x(s.status_lokasi,i)}}),e.jsxs("div",{className:"flex flex-col gap-xs",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"font-semibold",style:{color:x(s.status_lokasi,i)},children:N(s.status_lokasi,i)}),e.jsxs("span",{className:"text-xs text-secondary flex items-center gap-xs",children:[e.jsx(G,{size:12}),D(s.created_at)]})]}),s.keterangan&&e.jsxs("div",{className:"bg-gray-50 p-sm rounded text-sm text-secondary max-w-full break-words",children:['"',s.keterangan,'"']}),e.jsxs("div",{className:"text-xs text-muted flex items-center gap-xs mt-xs",children:[e.jsx(y,{size:12}),e.jsxs("span",{children:["Petugas: ",s.profiles?.nama||"Unknown"]})]})]})]},s.id))})})]})})]})})]})};export{ae as default};
